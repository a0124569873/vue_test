<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0"/>
    <title>幻盾DDOS动态防御系统-注册</title>
    <link rel="shortcut icon" href="/static/fonts/favicon.ico" />
    <style>
        *,::after,::before{box-sizing:border-box}
        html{background-color:#fff;color:#333;font-family:"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
        html,body{height:100%;background:#f5f5f6;}
        blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}
        button,input,legend,textarea{padding:0}
        fieldset,form,ol,td,th,ul{margin:0;padding:0}
        ul{list-style:none}
        a{text-decoration: none;}
        a:link{color:#00c1de;}
        a:visited{color:#00b7d3;}
        .pwd-reset-topbar{position:relative;height:60px;border-bottom:1px solid #d7d8d9;background-color: #f5f5f6;}
        .pwd-reset-topbar-logo{position:absolute;left:20px;height:59px;line-height:59px}
        .pwd-reset-topbar-logo img{width: 40px;height: 40px; vertical-align:middle}
        .pwd-reset-topbar-logo span{position:relative;top:2px;margin-left:5px;color:#333;font-size:20px;line-height:1;vertical-align:middle}
        .pwd-reset-body{padding:80px 0;background-color:#f5f5f6;text-align:center}
        .pwd-reset-body-box{position:relative;margin: 0 auto;padding:40px 0;width:1000px;background: #fff;}
        .pwd-reset-form{width:320px;margin: 0 auto;margin-top:40px;text-align: center;}
        .pwd-reset-form-title{font-size:30px;letter-spacing:1px;line-height:36px;color:#373D41;}
        .pwd-reset-form-tips{position:absolute;top:43px;right:40px;font-size:12px;color:#73777a;letter-spacing:.4px;line-height:30px;text-align:left;}
        .pwd-reset-success,.pwd-reset-error{display:none;margin-top:16px;margin-bottom:16px;padding:5px 10px;border:1px solid #f15532;background-color:#feeeeb;color:#f15532;text-align:left;font-size:14px}
        .pwd-reset-success{border:1px solid #35b34a;color:#35b34a;background-color:#dcf3e5;}
        .icon-right,.icon-error{display:inline-block;width:16px;height:16px;background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlLz48L2RlZnM+PHBhdGggZD0iTTUxMiA5NDcuMkMyNzEuMzYgOTQ3LjIgNzYuOCA3NTIuNjQgNzYuOCA1MTJTMjcxLjM2IDc2LjggNTEyIDc2LjggOTQ3LjIgMjcxLjM2IDk0Ny4yIDUxMiA3NTIuNjQgOTQ3LjIgNTEyIDk0Ny4yTTUxMiAwQzIzMC40IDAgMCAyMzAuNCAwIDUxMnMyMzAuNCA1MTIgNTEyIDUxMiA1MTItMjMwLjQgNTEyLTUxMlM3OTMuNiAwIDUxMiAwIiBmaWxsPSIjRjE1NTMzIi8+PHBhdGggZD0iTTcxNi44IDM1My4yOGwtNjEuNDQtNDYuMDhMNTEyIDQ1NS42OCAzNjguNjQgMzA3LjJsLTYxLjQ0IDQ2LjA4TDQ1NS42OCA1MTIgMzA3LjIgNjY1LjZsNjEuNDQgNTEuMkw1MTIgNTY4LjMyIDY1NS4zNiA3MTYuOGw2MS40NC01MS4yTDU2My4yIDUxMnoiIGZpbGw9IiNGMTU1MzMiLz48L3N2Zz4=);background-position:0 0;background-size:16px 16px;vertical-align:-3px}
        .icon-right{background: url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlLz48L2RlZnM+PHBhdGggZD0iTTUxMiA5NDcuMkMyNzEuMzYgOTQ3LjIgNzYuOCA3NTIuNjQgNzYuOCA1MTJTMjcxLjM2IDc2LjggNTEyIDc2LjggOTQ3LjIgMjcxLjM2IDk0Ny4yIDUxMiA3NTIuNjQgOTQ3LjIgNTEyIDk0Ny4yTTUxMiAwQzIzMC40IDAgMCAyMzAuNCAwIDUxMnMyMzAuNCA1MTIgNTEyIDUxMiA1MTItMjMwLjQgNTEyLTUxMlM3OTMuNiAwIDUxMiAwIiBmaWxsPSIjMzVCMzRBIi8+PHBhdGggZD0iTTcxNi44IDMwNy4yTDQ1MC41NiA2MjkuNzYgMzEyLjMyIDQ4MS4yOCAyNTYgNTMyLjQ4bDE5OS42OCAyMTUuMDQgMzE3LjQ0LTM5NC4yNHoiIGZpbGw9IiMzNUIzNEEiLz48L3N2Zz4=) no-repeat;background-size:contain;}
        .notice{padding:4px 8px}
        .pwd-reset-loading{display:none;position:absolute;top:0;left:0;width:100%;height:100%}
        .loading-icon{position:absolute;top:0;left:0;z-index:2;width:100%;height:100%;background:url(/image/ajax-loader-16x16.gif) no-repeat center center}
        .loading-mask{position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;background-color:#fff;opacity:.8}
        .form-content .form-input{display:block;margin-bottom:20px;padding:0 10px;width:100%;height:42px;outline:0;border:1px solid #d7d8d9;background-color:#fff;color:#595959;font-size:12px;line-height:42px}
        .code{overflow:hidden}
        .code .form-input{float:left;margin-right:3px;width:181px;}
        .code img{cursor:pointer}
        .form-content .form-input:focus,.form-content .form-input:hover,.form-input-single:focus, .form-input-single:hover{border:1px solid #00c1de}
        .form-submit{display:block;width:100%;height:40px;outline:0;border:1px solid #00c1de;border-radius:0;background-color:#00c1de;box-shadow:0 1px 1px #ebe7e6;color:#fff;text-align:center;font-weight:700;font-size:14px;line-height:40px;cursor:pointer}
        .form-submit:hover{border-color:#00b7d3;background-color:#00b7d3}
        .pwd-reset-other{overflow:hidden;margin-top:10px;text-align:right;zoom:1}
        .pwd-reset-other a{color:#989ea0;text-decoration:none;font-size:12px;cursor:pointer}
        .pwd-reset-other a:hover{color:#00c1de}
        .footer{padding:20px;background-color:#373d41}
        .footer-inner{margin-top:10px;margin-right:auto;margin-left:auto;width:1200px;color:#73777a;font-size:14px}
        .footer-inner .big{margin-bottom:32px}
        .footer-inner .big a{margin-right:35px;color:#9b9ea0;text-decoration:none;font-size:16px;-webkit-transition:color .3s;transition:color .3s}
        .footer-inner .big a:hover{color:#28d0e9}
        .copyright{margin-top:10px;color:#73777a;font-size:14px}
        .pwd-reset{position:relative;min-height:100%;margin-bottom:-150px;padding-bottom: 150px;}
        .footer{margin-top:-150px;height:150px;}
        .form-input-mobile{margin-bottom:20px;width:100%;height:42px;}
        .form-input-group{width:100%;height:100%;color:#373d41;font-size:12px;line-height:1.28571;display:inline-table;border-collapse:separate;border-spacing:0;}
        .form-input-addon{display:table-cell;padding:0 8px;vertical-align:middle;border-radius:0;width:48px;background:#fff;font-size:14px;height:40px;line-height:38px;white-space:nowrap;color:#9b9ea0;font-weight: 400;text-align: center;border:1px solid #c3c5c6;}
        .form-input-addon:first-child{border-right: 0;}
        .form-input-addon-before{border-bottom-right-radius: 0;border-top-right-radius: 0;}
        .form-input-single{display:inline-table;border-collapse:separate;margin-top:0;padding:0 8px;width:100%;height:100%;color: #595959;font-size:12px;outline:none;overflow:visible;border:1px solid #ebecec;border-spacing:0;background-color:#fff;transition:all .3s ease-out;border-radius:0;border-color:#c3c5c6;}
      </style>
  </head>

  <body>
    <div class="pwd-reset">
      <div class="pwd-reset-topbar">
        <a class="pwd-reset-topbar-logo">
          <img src="/static/img/dun.png">
          <span>幻盾DDOS动态防御系统</span>
        </a>
      </div>

      <div class="pwd-reset-body">
        <div class="pwd-reset-body-box">
          <div class="pwd-reset-form-title">重置密码</div>

          <form class="pwd-reset-form">
            <div class="pwd-reset-error">
              <span class="icon-error"></span>
              <span class="notice error-notice"></span>
            </div>

            <div class="pwd-reset-success">
              <span class="icon-right"></span>
              <span class="notice">密码重置成功</span>
            </div>

            <div id="js-pwd-reset-loading" class="pwd-reset-loading">
              <div class="loading-icon"></div>
              <div class="loading-mask"></div>
            </div>

            <div class="form-content">
              <input class="form-input" type="password" placeholder="设置你的登录密码，长度至少为8位，必填" id="js-password" name="password" tabindex="1" autofocus>
              <input class="form-input" type="password" placeholder="请再次输入你的密码，长度至少为8位，必填" id="js-password-confirm" name="passwordConfirm" tabindex="2">
              <input type="submit" class="form-submit" id="js-submit" value="重置">
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="footer-inner">
        <p class="big">
          <a href="#">关于我们</a>
          <a href="#">法律声明及隐私权政策</a>
          <a href="#">联系我们</a>
        </p>

        <div class="copyright">
          <p>北京卫达科技有限公司版权所有 Copyright © 2015-2018</p>
          <p>www.veda.com</p>
        </div>
      </div>
    </div>
    <script src="/static/jquery.min.js"></script>
    <script>
      var blankReg = /^\s*$/
      var pwdReg = /^[\w.]{8,}$/
      var mobileReg = /^1[34578]\d{9}$/
      var email = "{$email}"
      var token = "{$token}"

      function checkValid() {
        $('.pwd-reset-success').hide()
        var pwd = $('#js-password').val()
        var pwd2 = $('#js-password-confirm').val()

        if (blankReg.test(pwd)) {
          $('.error-notice').html('请输入密码')
          $('.pwd-reset-error').show()
          return false
        } else {
          if (!pwdReg.test(pwd)) {
            $('.error-notice').html('请检查密码格式（长度至少为8位）')
            $('.pwd-reset-error').show()
            return false
          }
        }
        if (blankReg.test(pwd2)) {
          $('.error-notice').html('请输入确认密码')
          $('.pwd-reset-error').show()
          return false
        } else {
          if (pwd != pwd2) {
            $('.error-notice').html('两次密码不一致')
            $('.pwd-reset-error').show()
            return false
          }
        }

        $('.pwd-reset-error').hide()
        return true
      }
      $(function() {
        var $loading = $('.pwd-reset-loading')

        $('#js-submit').on('click', function(e) {
          e.preventDefault()
          if (checkValid()) {
            $loading.show()
            $.ajax({
              url: '/v1/password',
              type: 'put',
              dataType: 'json',
              data: {
                email: email,
                token: token,
                new_pwd: $('#js-password').val(),
              }
            })
            .done(function(data) {
              if (data.errcode != 0) {
                $('.error-notice').html(data.errmsg)
                $('.pwd-reset-error').show()
              } else {
                $('.pwd-reset-error').hide()
                $('.pwd-reset-success').show()
                setTimeout(function() {
                  window.location.href = '/login'
                }, 1000)
              }
            })
            .fail(function(err) {
              $('.error-notice').html('修改密码失败')
              $('.pwd-reset-error').show()
            })
            .always(function() {
              $loading.hide()
            })
          }
        })
      })

    </script>
  </body>
</html>

